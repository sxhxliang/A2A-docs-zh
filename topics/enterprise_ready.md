# 企业级支持

<!-- TOC -->

- [企业级支持](#企业级支持)
  - [传输层安全](#传输层安全)
  - [服务端身份](#服务端身份)
  - [客户端与用户身份](#客户端与用户身份)
  - [客户端认证](#客户端认证)
  - [授权与数据隐私](#授权与数据隐私)
  - [追踪与可观测性](#追踪与可观测性)

<!-- /TOC -->

A2A**不会**创造新的企业安全标准，而是与现有基础设施无缝集成。

A2A将企业级智能体建模为标准HTTP企业应用，因此依赖企业级标准的认证、安全、隐私、追踪和监控机制。这种设计之所以可行，是因为A2A智能体具有不透明性且不共享工具或资源（因此适用"单应用"客户端/服务端的最佳实践）。

实际上，A2A将大多数企业级关注点排除在协议之外，转而要求具备支持开放式认证和追踪的企业级HTTP实现。实施者应遵循所有与应用及用户安全相关的企业最佳实践。

## 传输层安全
A2A基于HTTP构建，任何生产环境部署都应要求使用现代TLS加密的HTTPS。

## 服务端身份
A2A服务端通过知名证书机构签发的数字证书在TLS协商过程中呈现身份。A2A客户端应在建立连接时验证服务端身份。

## 客户端与用户身份
A2A架构中不包含用户或客户端标识符概念，而是通过协议传递认证要求（方案和材料）。客户端负责与适当的认证机构（A2A协议外）协商并获取/存储凭证材料（如OAuth令牌）。这些凭证材料将通过HTTP头传输，而非A2A载荷。

不同认证协议和服务提供商有不同要求，单个请求可能需要在方案特定头中包含多个标识符和身份。建议客户端在向A2A服务端发起请求时始终提供代表客户端智能体的身份和代表终端用户的身份。

**注意**：多身份联合是待讨论的开放话题。例如用户U与需要A系统标识符的智能体A协作时，若智能体A依赖需要B系统标识符的工具B或智能体B，则用户可能需在单个请求中同时提供A系统和B系统的身份（假设A系统是企业LDAP身份，B系统是SaaS提供商身份）。

当前建议：若智能体A要求用户/客户端为任务某部分提供替代身份，应以`INPUT-REQUIRED`状态向客户端发送包含特定认证要求（与智能体名片的认证要求结构相同）的更新。客户端随后在A2A协议及A系统之外，与B系统的认证机构协商获取凭证材料。这些材料（如令牌）可通过智能体A传递给智能体B，由智能体B与上游系统交互时使用。

## 客户端认证
A2A服务端应在[智能体名片](/documentation.md#agent-card)中公布支持及要求的认证协议。这些协议应为标准[OpenAPI认证格式](https://swagger.io/docs/specification/v3_0/authentication/)（如API密钥、OAuth、OIDC等），但可扩展为客户端和服务端共同支持的其他协议。

各认证协议有独立的凭证获取、刷新和质询机制（如持有者令牌或会话令牌）。凭证获取和维护过程被视为A2A协议外的行为。

A2A服务端应对**每个**请求进行认证，并通过标准HTTP状态码（401、403）及协议特定头信息（如包含[WWW-Authenticate](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/WWW-Authenticate)头的HTTP 401响应）拒绝未认证请求。

## 授权与数据隐私
A2A服务端应基于用户和应用身份进行请求授权。建议单个智能体至少从两个维度管理访问：

* **技能**  
智能体应通过[智能体名片](/documentation.md#agent-card)公布其技能形式的能力。建议按技能进行授权（例如OAuthScope 'foo-read-only'可限制仅访问'generateRecipe'技能）。

* **工具（操作与数据）**  
建议智能体通过工具限制对敏感数据或操作的访问。当智能体流程或模型需要访问这些数据时，应基于应用+用户权限授权工具访问。强烈建议使用带工具访问权限的API管理方案。

## 追踪与可观测性
由于所有A2A请求都是"标准"HTTP请求，客户端和服务端都应使用企业标准工具和基础设施，理想情况下应添加适当的检测头并将事件写入标准日志和事件队列。